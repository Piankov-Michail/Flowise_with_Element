version: '3.8'

services:
  # Matrix Synapse Server
  synapse:
    image: matrixdotorg/synapse:latest
    container_name: synapse
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "8008:8008/tcp"
    volumes:
      - synapse-data:/data
    environment:
      - SYNAPSE_SERVER_NAME=localhost
      - SYNAPSE_REPORT_STATS=no
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8008/health"]
      interval: 30s
      timeout: 10s
      retries: 3

  # Flowise Service
  flowise:
    image: flowiseai/flowise:latest
    container_name: flowise
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "3000:3000"
    volumes:
      - flowise-data:/app/data
    environment:
      - FLOWISE_USERNAME=admin
      - FLOWISE_PASSWORD=password
      - PORT=3000

  # Bot Manager Service
  bot-manager:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bot-manager
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "8001:8001"
    depends_on:
      - synapse
      - flowise
    environment:
      - PYTHONUNBUFFERED=1

networks:
  matrix-network:
    driver: bridge

volumes:
  synapse-data:
  flowise-data: