services:
  # Matrix Synapse Server
  synapse:
    image: matrixdotorg/synapse:latest
    container_name: synapse
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "8008:8008/tcp"
    volumes:
      - synapse-data:/data
      - ./synapse/config/homeserver.yaml:/data/homeserver.yaml
      - ./synapse/config/homeserver.log.config:/data/homeserver.log.config
    environment:
      - SYNAPSE_SERVER_NAME=${SYNAPSE_SERVER_NAME}
      - SYNAPSE_REPORT_STATS=${SYNAPSE_REPORT_STATS}

  # Flowise Service
  flowise:
    image: flowiseai/flowise:latest
    container_name: flowise
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "3000:3000"
    volumes:
      - flowise-data:/app/data
    environment:
      - FLOWISE_USERNAME=admin
      - FLOWISE_PASSWORD=password
      - PORT=3000

  # Bot Manager Service
  bot-manager:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: bot-manager
    restart: unless-stopped
    networks:
      - matrix-network
    ports:
      - "8001:8001"
    depends_on:
      - synapse
      - flowise
    environment:
      - PYTHONUNBUFFERED=1

networks:
  matrix-network:
    driver: bridge

volumes:
  synapse-data:
  flowise-data: